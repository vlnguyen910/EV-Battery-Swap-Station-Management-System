## Auth Service

![alt text](image.png)

AuthContext (Global State Layer)
â†“
useAuth (Hook Interface Layer)  
 â†“
useAuthHandlers (Business Logic Layer)
â†“  
AuthContainer (Container Layer)
â†“
Login/Register (Presentation Layer)

ğŸ“‹ Vai trÃ² tá»«ng lá»›p:

1. AuthContext (Global State Management)
   Chá»©c nÄƒng: Quáº£n lÃ½ global auth state cho toÃ n app
   TrÃ¡ch nhiá»‡m:
   LÆ°u trá»¯ user, token, loading, error
   Cung cáº¥p base auth functions (login, logout, register)
   Persist state vá»›i localStorage
   Decode JWT token
   Scope: ToÃ n app (wrap tá»« main.jsx)
2. useAuthHandlers (Business Logic & Side Effects)
   Chá»©c nÄƒng: Xá»­ lÃ½ business logic specific cho login/register
   TrÃ¡ch nhiá»‡m:
   Gá»i AuthContext functions
   Xá»­ lÃ½ role-based navigation
   Handle async states vá»›i useAsyncHandler
   Side effects nhÆ° setTimeout, console.log
   Scope: Component level
3. AuthContainer (UI Container)
   Chá»©c nÄƒng: Orchestrate UI cho auth flow
   TrÃ¡ch nhiá»‡m:
   Chá»n render Login hay Register dá»±a trÃªn mode
   Bridge giá»¯a useAuthHandlers vÃ  presentation components
   Pass props xuá»‘ng UI components
   Scope: Auth pages

## ğŸ”„ Má»‘i quan há»‡ vÃ  Data Flow:

```
User submit form â†’ Login/Register (presentation) â†’ onSubmit(formData) â†’
AuthContainer â†’ useAuthHandlers â†’ useAsyncHandler â†’ AuthContext â†’
authService â†’ API â†’ Response â†’ navigate based on role
```

## ğŸ’¡ Táº¡i sao cáº§n cáº£ hai:

### AuthContext khÃ´ng thá»ƒ thay tháº¿ AuthContainer vÃ¬:

1. **Separation of Concerns**:

```jsx
// AuthContext: Pure state management
const login = async (credentials) => {
  // Just handle API call and state
  const response = await loginService(credentials);
  setUser(userData);
  return userData;
};

// useAuthHandlers: Business logic + side effects
const loginHandler = async (credentials) => {
  const user = await login(credentials); // Gá»i AuthContext
  // Business logic: role-based navigation
  if (user.role === "admin") navigate("/admin");
};
```

2. **Reusability**: AuthContext cÃ³ thá»ƒ dÃ¹ng á»Ÿ nhiá»u nÆ¡i khÃ¡c, khÃ´ng chá»‰ login/register
3. **Testing**: CÃ³ thá»ƒ test AuthContext vÃ  useAuthHandlers riÃªng biá»‡t

### AuthContainer khÃ´ng thá»ƒ thay tháº¿ AuthContext vÃ¬:

1. **Global State**: AuthContext cáº§n share state cho toÃ n app
2. **Persistence**: AuthContext handle localStorage
3. **Token Management**: AuthContext decode JWT vÃ  manage tokens

## ğŸ¯ Káº¿t luáº­n:

**KHÃ”NG Bá» CÃI NÃ€O!** Má»—i lá»›p cÃ³ vai trÃ² riÃªng:

- **AuthContext**: Global state store (nhÆ° Redux store)
- **useAuthHandlers**: Business logic hooks
- **AuthContainer**: UI orchestration
- **Login/Register**: Pure presentation

## ğŸ”§ Analogy dá»… hiá»ƒu:

```
AuthContext = Database (lÆ°u trá»¯ global state)
useAuthHandlers = Service Layer (business logic)
AuthContainer = Controller (Ä‘iá»u phá»‘i UI)
Login/Register = View (hiá»ƒn thá»‹ form)
```

**Kiáº¿n trÃºc nÃ y chuáº©n React patterns vÃ  scalable cho dá»± Ã¡n lá»›n!** ğŸš€

## ğŸ“ Cáº¥u trÃºc file hoÃ n chá»‰nh:

```
src/
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.jsx          # Global state management
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAuth.js               # Hook interface layer
â”‚   â”œâ”€â”€ useAsyncHandler.js       # Generic async state handler
â”‚   â””â”€â”€ useAuthHandlers.js       # Auth-specific business logic
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ containers/
â”‚   â”‚   â””â”€â”€ AuthContainer.jsx    # UI container orchestration
â”‚   â””â”€â”€ auth/
â”‚       â”œâ”€â”€ Login.jsx            # Pure presentation component
â”‚       â””â”€â”€ Register.jsx         # Pure presentation component
â””â”€â”€ services/
    â”œâ”€â”€ api.js                   # HTTP client
    â””â”€â”€ authService.js           # Auth API calls
```

##### SWAGGER and POSTMAN

1. Cháº¡y swagger trÃªn localhost: localhost:8080/api/docs

2. Muá»‘n thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ Ä‘Ã³ thÃ¬ pháº£i cÃ³ accessToken, láº¥y accessToken lÃºc Ä‘Äƒng nháº­p trong LocalStorage

3. TÆ°Æ¡ng Ä‘Æ°Æ¡ng bÃªn Postman cÅ©ng authorize báº±ng cÃ¡i token Ä‘Ã³ lÃ  dc

#### CÃ¡ch cÃ¡c class tÆ°Æ¡ng tÃ¡c vá»›i nhau trong luá»“ng authentication vÃ  gá»i API.

1. AuthContext.jsx â€” Global auth state (Provider)
   Vai trÃ²: lÆ°u user, token, loading, error; cung cáº¥p hÃ m login/logout/register cho toÃ n app.
   Hoáº¡t Ä‘á»™ng:
   Gá»i authService.login/register (thÃ´ng qua loginService/registerService).
   Khi login thÃ nh cÃ´ng: decode accessToken (base64) â†’ dá»±ng userData â†’ setUser, setToken â†’ lÆ°u localStorage.
   Khi logout: gá»i logoutService() (best-effort), xÃ³a state + localStorage.
   useEffect cháº¡y 1 láº§n Ä‘á»ƒ restore user tá»« localStorage khi reload.
   GiÃ¡ trá»‹ cung cáº¥p (value cá»§a Provider): { user, token, loading, error, isAuthenticated, login, logout, register }.

2. authService.js â€” API layer cho auth
   Vai trÃ²: wrapper gá»i cÃ¡c endpoint auth qua axios instance (services/api.js).
   CÃ¡c hÃ m: login(credentials) â†’ POST API_ENDPOINTS.AUTH.LOGIN; register(userInfo); logout() (client cleanup); getProfile(); getAllUser().
   Tráº£ lá»—i lÃªn caller (throw) Ä‘á»ƒ context hoáº·c container xá»­ lÃ½ UI.

3. api.js â€” Axios instance chung
   Vai trÃ²: táº¡o axios vá»›i baseURL tá»« constants.API_BASE_URL, set Content-Type.
   Interceptor request Ä‘á»c token tá»« localStorage vÃ  gáº¯n header Authorization tá»± Ä‘á»™ng.
   Nhá» váº­y toÃ n bá»™ service dÃ¹ng api sáº½ gá»­i token náº¿u cÃ³.

4. useApi.js â€” Hook wrapper API nhá»
   Vai trÃ²: láº¥y token tá»« useAuth() vÃ  thá»±c hiá»‡n call API Ä‘á»™ng (callApi(method, url, data, config)).
   Lá»±a chá»n: báº¡n Ä‘ang sá»­ dá»¥ng api instance Ä‘Ã£ configure interceptor â†’ useApi lÃ  tiá»‡n Ã­ch (khÃ´ng báº¯t buá»™c nhÆ°ng há»¯u Ã­ch).

5. useAuth.js â€” Hook tiÃªu chuáº©n Ä‘á»ƒ read AuthContext
   Tráº£ vá» useContext(AuthContext). DÃ¹ng trong components / hooks Ä‘á»ƒ truy cáº­p login/logout/user.

6. index.js â€” Base URL + endpoint definitions
   Vai trÃ²: táº­p trung endpoint vÃ  route.
   LÆ°u Ã½: hiá»‡n file cÃ³ cÃ¡c endpoint dynamic viáº¿t sai (vÃ­ dá»¥ /users/${(id) => id}) â€” nÃªn export factory functions thay vÃ¬ template string dÃ¹ng arrow. VÃ­ dá»¥ sá»­a:

7. useAsyncHandler.js â€” Generic async state hook
   Vai trÃ²: tÃ¡i sá»­ dá»¥ng quáº£n lÃ½ loading/error/success cho báº¥t ká»³ async task nÃ o.
   API: tráº£ vá» { run, loading, error, success, setError, setSuccess }.
   DÃ¹ng lÃ m building block cho handlers auth-specific.

8. useAuthHandlers.js â€” Auth-specific business hooks
   Vai trÃ²: dÃ¹ng useAsyncHandler + useAuth + useNavigate Ä‘á»ƒ implement cÃ¡c hÃ nh vi login/register:
   Gá»i context.login/register.
   Xá»­ lÃ½ side-effects: role-based navigate, redirect sau register, toast/log, onError callback.
   Tráº£ ra submit function (run) cÃ¹ng loading/error/success Ä‘á»ƒ container dÃ¹ng.

9. AuthContainer.jsx â€” Container component
   Vai trÃ²: orchestration UI: chá»n render Login hay Register dá»±a trÃªn prop mode; láº¥y submit/loading/error tá»« useAuthHandlers vÃ  truyá»n xuá»‘ng presentation components.
   KhÃ´ng chá»©a business logic náº·ng â€” chá»‰ bind hook â†’ presentation.

10. Login.jsx / Register.jsx â€” Presentation components
    Vai trÃ²: giá»¯ local form state, validation nháº¹, render form UI.
    Khi submit: gá»i props.onSubmit(formData) (khÃ´ng gá»i login trá»±c tiáº¿p).
    Show loading/error/success dá»±a trÃªn props

### Luá»“ng dá»¯ liá»‡u (tÃ³m táº¯t)

User submit â†’ Presentation gá»i onSubmit(formData) â†’ AuthContainer â†’ useAuthHandlers.run(formData) â†’ useAsyncHandler cháº¡y â†’ gá»i AuthContext.login/register â†’ AuthContext gá»i authService â†’ api.js gá»­i request â†’ backend tráº£ vá» â†’ AuthContext cáº­p nháº­t token/user â†’ useAuthHandlers xá»­ side-effect (navigate) â†’ container/presentation cáº­p nháº­t UI via loading/error/success.
