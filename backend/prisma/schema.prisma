generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  driver
  station_staff
  admin
}

enum VehicleStatus {
  active
  inactive
}

enum StationStatus {
  active
  inactive
  maintenance
}

enum BatteryStatus {
  full
  charging
  booked
  defective
}

enum ReservationStatus {
  scheduled
  completed
  cancelled
}

model User {
  user_id    Int      @id @default(autoincrement())
  username   String
  password   String
  phone      String   @unique
  email      String   @unique
  role       Role
  created_at DateTime @default(now())

  // Relationships
  vehicles    Vehicle[]
  Reservation Reservation[]

  @@map("users")
}

model Vehicle {
  vehicle_id    Int           @id @default(autoincrement())
  user_id       Int
  battery_id    Int?          @unique
  vin           String        @unique @db.VarChar(50)
  battery_model String        @db.VarChar(50)
  battery_type  String        @db.VarChar(50)
  status        VehicleStatus

  // Relationships
  user        User?         @relation(fields: [user_id], references: [user_id])
  battery     Battery?      @relation(fields: [battery_id], references: [battery_id])
  Reservation Reservation[]

  @@map("vehicles")
}

model SwappingStation {
  station_id Int           @id @default(autoincrement())
  name       String        @db.VarChar(100)
  address    String        @db.VarChar(255)
  latitude   Decimal       @db.Decimal(10, 8) // 10 digits total, 8 after decimal
  longitude  Decimal       @db.Decimal(11, 8) // 11 digits total, 8 after decimal
  status     StationStatus

  batteries   Battery[]
  Reservation Reservation[]
}

model Battery {
  battery_id     Int           @id @default(autoincrement())
  vehicle_id     Int?          @unique
  station_id     Int?
  model          String        @db.VarChar(100)
  type           String        @db.VarChar(50)
  capacity       Decimal       @db.Decimal(5, 2) // 5 digits total, 2 after decimal
  current_charge Decimal       @db.Decimal(5, 2) // 5 digits total, 2 after decimal
  soh            Decimal       @db.Decimal(5, 2) // 5 digits total, 2 after decimal
  status         BatteryStatus

  // Relationships
  vehicle     Vehicle?
  station     SwappingStation? @relation(fields: [station_id], references: [station_id])
  Reservation Reservation[]

  @@map("batteries")
}

model BatteryServicePackage {
  package_id    Int     @id @default(autoincrement())
  name          String  @db.VarChar(100)
  base_distance Int
  base_price    Decimal @db.Decimal(12, 2)
  swap_count    Int
  penalty_fee   Int
  duration_days Int
  description   String? @db.VarChar(255)
  active        Boolean

  @@map("battery_service_packages")
}

model Reservation {
  reservation_id Int               @id @default(autoincrement())
  user_id        Int
  vehicle_id     Int
  battery_id     Int
  station_id     Int
  scheduled_time DateTime
  status         ReservationStatus

  // Relationships
  user    User            @relation(fields: [user_id], references: [user_id])
  vehicle Vehicle         @relation(fields: [vehicle_id], references: [vehicle_id])
  battery Battery         @relation(fields: [battery_id], references: [battery_id])
  station SwappingStation @relation(fields: [station_id], references: [station_id])

  @@map("reservations")
}
